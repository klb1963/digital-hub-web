// src/app/faq/page.tsx
"use client";

import { useState } from "react";
import Link from "next/link";
import { AskQuestionDialog } from "@/components/contact/AskQuestionDialog";

type FaqItem = {
  question: string;
  answer: string;
  details?: string;
};

type FaqGroup = {
  id: string;
  title: string;
  items: FaqItem[];
};

const faqGroups: FaqGroup[] = [
  {
    id: "about-work",
    title: "О работе и формате IT-партнёрства",
    items: [
      {
        question: "Что вы делаете как IT-партнёр для владельца бизнеса?",
        answer:
          "Я подключаюсь к уже существующим ИТ-проектам и помогаю вернуть контроль: разобраться, стабилизировать и развивать.",
        details:
          "Типичные кейсы: сайт/интернет-магазин «держится на одном подрядчике», проект работает нестабильно, нет документации и доступов, непонятно, где узкие места и сколько «реально стоит» доработка. Моя роль — сделать систему понятной и управляемой для владельца бизнеса."
      },
      {
        question: "Можно ли начать с малого, без долгого контракта?",
        answer:
          "Да. Лучший старт — ИТ-диагностика проекта или короткая онлайн-сессия.",
        details:
          "Вы описываете ситуацию, я уточняю вопросы и предлагаю формат. Часто начинаем с ИТ-диагностики: за 2 часа собираем картину проекта, фиксируем риски и приоритеты, а дальше вы решаете — продолжать сотрудничество или остановиться на этом этапе."
      },
      {
        question: "Чем вы отличаетесь от фрилансера или агентства?",
        answer:
          "Я не «продаю разработку» — моя задача защитить интересы бизнеса и дать понятный план действий.",
        details:
          "Фокус — прозрачность, здравый смысл и снижение рисков. Я помогаю не переплатить за лишнее, не застрять в бесконечных переделках и не зависеть от одного исполнителя. Если нужен подрядчик/команда — помогу выбрать и выстроить работу так, чтобы проект был управляемым."
      }
    ]
  },
  {
    id: "diagnostics",
    title: "ИТ-диагностика проекта",
    items: [
      {
        question: "Что такое ИТ-диагностика проекта и зачем она нужна?",
        answer:
          "Это короткая, прикладная сессия, после которой у вас появляется ясность: что происходит в проекте и что делать дальше.",
        details:
          "За 2 часа мы разбираем текущую картину: платформа/код/интеграции/хостинг/доступы/процессы. На выходе — конкретные выводы, список рисков и приоритетов, а также план следующих шагов."
      },
      {
        question: "Что нужно подготовить до диагностики?",
        answer:
          "Минимум: ссылку на сайт/магазин и пару предложений о том, что не устраивает.",
        details:
          "Если есть — отлично: список доступов (хостинг, домены, админки), репозиторий, аналитика, список интеграций (оплаты, CRM, склад, доставки), контакты текущего подрядчика. Но отсутствие этих данных — не блокер: часто как раз в этом и проблема, и мы её фиксируем."
      },
      {
        question: "Какой результат я получу по итогу?",
        answer:
          "Понятный список проблем и рисков, приоритеты и реалистичный план работ.",
        details:
          "Вы будете понимать: что критично (безопасность/доступы/стабильность), что даёт быстрый эффект, какие есть варианты решения (доработать/перевести/переписать), и как это соотносится со сроками и бюджетом."
      }
    ]
  },
  {
    id: "existing-projects",
    title: "Существующие сайты, магазины и системы",
    items: [
      {
        question: "Вы подключаетесь к уже сделанному проекту, даже если код «чужой»?",
        answer: "Да. Это один из самых частых сценариев моей работы.",
        details:
          "Обычно начинаем с диагностики и «инвентаризации»: что реально работает, что ломается, где находятся ключевые зависимости и кто владеет доступами. Дальше — план стабилизации и улучшений."
      },
      {
        question: "Когда лучше «чинить», а когда проще переделать заново?",
        answer:
          "Это решается после диагностики: иногда достаточно стабилизации, иногда выгоднее аккуратная миграция или частичная переработка.",
        details:
          "Критерии: стоимость поддержки, скорость внесения изменений, качество данных, риски безопасности, ограничения платформы, степень «завязки» на подрядчика. Моя задача — дать прагматичный ответ, а не «переписывать всё ради переписывания»."
      },
      {
        question: "Поможете снизить зависимость от одного программиста или агентства?",
        answer:
          "Да. Это одна из главных целей: сделать проект понятным, документированным и переносимым.",
        details:
          "Мы приводим в порядок доступы, репозиторий, окружения, документацию, процессы и критерии качества. В результате вы можете менять исполнителей без потери контроля и без угрозы остановки проекта."
      }
    ]
  },
  {
    id: "tech",
    title: "Технологии, стек и подход",
    items: [
      {
        question: "С какими платформами и технологиями вы работаете?",
        answer:
          "Я работаю с современным веб-стеком и часто разбираю проекты на популярных CMS и e-commerce платформах.",
        details:
          "Мой основной стек: Next.js/React, Node.js/NestJS, PostgreSQL/Prisma, Docker/CI/CD. В реальности же часто встречаются WordPress, Shopify, WooCommerce, самописные решения, различные интеграции с оплатами/CRM/складом — и моя задача быстро в них ориентироваться и навести порядок."
      },
      {
        question: "Вы пишете код сами или управляете подрядчиками?",
        answer: "И так, и так — в зависимости от задачи и объёма.",
        details:
          "Иногда я делаю ключевые технические работы сам (стабилизация, архитектурные узлы, инфраструктура). Иногда помогаю организовать работу команды/подрядчика: ставим правила, критерии качества, процессы и контроль прогресса — чтобы бизнес не платил за хаос."
      },
      {
        question: "Можно ли подключить AI/автоматизацию в бизнес-процессы?",
        answer:
          "Да, если это даёт измеримую пользу: экономит время, снижает ошибки или ускоряет продажи/поддержку.",
        details:
          "После того как базовая архитектура и процессы приведены в порядок, можно аккуратно подключать AI-автоматизацию: контент, ответы поддержки, анализ заявок, внутренние ассистенты. Я стараюсь начинать с прагматичных сценариев и быстрых выигрышей."
      }
    ]
  },
  {
    id: "terms",
    title: "Организация работы, оплата и коммуникации",
    items: [
      {
        question: "Как обычно организована работа?",
        answer:
          "Диагностика → план → стабилизация/улучшения → регулярное сопровождение и развитие.",
        details:
          "Мы фиксируем цели и ограничения, согласуем формат и каналы связи, а дальше работаем прозрачно: с приоритетами, короткими итерациями и демонстрациями результата. Вы всегда понимаете, что делается и зачем."
      },
      {
        question: "В каком формате вы работаете и сколько это стоит?",
        answer:
          "Обычно это 20–50 часов в месяц по 60 €/час. Можно начать с диагностики.",
        details:
          "Если задача маленькая или нужна точечная помощь — возможны разовые сессии. Если нужно сопровождение — работаем ежемесячно без долгосрочных контрактов. Формат уточняем после диагностики, когда ясны объём и приоритеты."
      },
      {
        question: "В каких каналах мы будем общаться?",
        answer: "Выбираем те каналы, которые удобны вам.",
        details:
          "Обычно это email, LinkedIn, Telegram и видеосозвоны на meet.leonidk.de. Если у вас уже есть Slack/Teams/Notion/Jira — подстроюсь под ваш процесс."
      }
    ]
  }
];

export default function FaqPage() {
  const [openItemId, setOpenItemId] = useState<string | null>(null);

  const toggleItem = (id: string) => {
    setOpenItemId((prev) => (prev === id ? null : id));
  };

  return (
    <section className="min-h-[70vh] bg-[#05070B] py-16 text-slate-100">
      <div className="mx-auto max-w-5xl px-6">
        {/* Навигация / крошки */}
        <div className="text-base text-slate-500">
          <Link href="/" className="hover:text-emerald-300">
            ← На главную
          </Link>
        </div>

        {/* Hero FAQ */}
        <header className="mt-8">
          <p className="mb-4 text-xl font-semibold uppercase tracking-[0.18em] text-emerald-400">
            FAQ
          </p>
          <h1 className="mt-3 text-4xl font-semibold tracking-tight text-slate-50 md:text-5xl">
            Частые вопросы владельцев бизнеса про ИТ-проекты и работу со мной
          </h1>
          <p className="mt-5 max-w-3xl text-base leading-relaxed text-slate-300 md:text-lg">
            Здесь собраны вопросы, которые чаще всего возникают, когда у бизнеса уже
            есть сайт, интернет-магазин или внутренняя система — но не хватает
            контроля, стабильности или понятного плана развития. Часто мы начинаем с
            ИТ-диагностики проекта.
          </p>
        </header>

        {/* Группы FAQ */}
        <div className="mt-12 space-y-10">
          {faqGroups.map((group) => (
            <FaqGroup
              key={group.id}
              group={group}
              openItemId={openItemId}
              onToggle={toggleItem}
            />
          ))}
        </div>

        {/* CTA внизу FAQ */}
        <div className="mt-14 rounded-3xl border border-slate-800 bg-slate-900/40 px-6 py-10 text-center shadow-[0_0_40px_rgba(0,0,0,0.45)] md:px-10 md:py-12">
          <h2 className="text-xl font-semibold text-slate-50 md:text-2xl">
            Не нашли ответ на свой вопрос?
          </h2>
          <p className="mx-auto mt-4 max-w-3xl text-base leading-relaxed text-slate-300 md:text-lg">
            Опишите проект в нескольких строках — я подскажу, подойдёт ли формат
            ИТ-диагностики и какие шаги имеет смысл сделать дальше.
          </p>
          <div className="mt-8 flex justify-center">
            <AskQuestionDialog />
          </div>
          <p className="mt-5 text-sm text-slate-500">
            Я отвечаю лично. Без спама и рассылок — только предметный диалог.
          </p>
        </div>
      </div>
    </section>
  );
}

function FaqGroup({
  group,
  openItemId,
  onToggle
}: {
  group: FaqGroup;
  openItemId: string | null;
  onToggle: (id: string) => void;
}) {
  return (
    <section className="rounded-3xl border border-slate-800 bg-slate-900/40 p-6 shadow-[0_0_30px_rgba(0,0,0,0.4)] md:p-7">
      <h2 className="text-base font-semibold uppercase tracking-[0.16em] text-slate-300">
        {group.title}
      </h2>
      <div className="mt-5 divide-y divide-slate-800">
        {group.items.map((item, index) => {
          const id = `${group.id}-${index}`;
          const isOpen = openItemId === id;

          return (
            <FaqItem
              key={id}
              id={id}
              item={item}
              isOpen={isOpen}
              onToggle={onToggle}
            />
          );
        })}
      </div>
    </section>
  );
}

function FaqItem({
  id,
  item,
  isOpen,
  onToggle
}: {
  id: string;
  item: FaqItem;
  isOpen: boolean;
  onToggle: (id: string) => void;
}) {
  return (
    <div className="py-4 first:pt-0 last:pb-0">
      <button
        type="button"
        onClick={() => onToggle(id)}
        className="flex w-full items-start justify-between gap-5 text-left"
        aria-expanded={isOpen}
      >
        <div className="pr-2">
          <p className="text-base font-medium text-slate-100 md:text-lg">
            {item.question}
          </p>
          {isOpen && (
            <div className="mt-3 space-y-2 text-base leading-relaxed text-slate-300 md:text-lg">
              <p>{item.answer}</p>
              {item.details && (
                <p className="text-base leading-relaxed text-slate-200 md:text-lg">
                  {item.details}
                </p>
              )}
            </div>
          )}
        </div>

        <div className="mt-1 flex h-8 w-8 flex-none items-center justify-center rounded-full border border-slate-600 text-sm text-slate-300">
          {isOpen ? "−" : "+"}
        </div>
      </button>
    </div>
  );
}